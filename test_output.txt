test
+- run test stderr
AccuracyCoin.nes loaded successfully:
  Mapper: 0
  PRG ROM: 32 KB
  CHR ROM: 8 KB
  Mirroring: horizontal
  Reset vector: $8004
test
+- run test stderr
=== Test: BIT $2002 with VBlank ===

Test 1: VBlank CLEAR
  After BIT: N=false, VBlank=false

Test 2: VBlank SET
  After BIT: N=true, VBlank=false

✓ BIT $2002 correctly sets N flag and clears VBlank

=== Test: BIT $2002 + BPL loop exit ===
  VBlank set before loop
  After BIT: N=true, PC=0x0003
  After BPL: PC=0x0005

✓ BPL correctly did NOT branch when N=1
test
+- run test 13/15 passed, 2 failed
error: 'sprite_evaluation_test.test.Sprite Evaluation: Sprite overflow cleared at pre-render scanline' failed: /home/colin/.local/lib/zig/std/testing.zig:607:14: 0x115cdb9 in expect (std.zig)
    if (!ok) return error.TestUnexpectedResult;
             ^
/home/colin/Development/RAMBO/tests/ppu/sprite_evaluation_test.zig:379:5: 0x115e599 in test.Sprite Evaluation: Sprite overflow cleared at pre-render scanline (sprite_evaluation_test.zig)
    try testing.expect(!ppu.status.sprite_overflow);
    ^
error: 'sprite_evaluation_test.test.Sprite 0 Hit: Cleared at pre-render scanline' failed: /home/colin/.local/lib/zig/std/testing.zig:607:14: 0x115cdb9 in expect (std.zig)
    if (!ok) return error.TestUnexpectedResult;
             ^
/home/colin/Development/RAMBO/tests/ppu/sprite_evaluation_test.zig:456:5: 0x115f425 in test.Sprite 0 Hit: Cleared at pre-render scanline (sprite_evaluation_test.zig)
    try testing.expect(!ppu.status.sprite_0_hit);
    ^
error: while executing test 'sprite_evaluation_test.test.Sprite Evaluation: Rendering disabled prevents evaluation', the following test command failed:
./.zig-cache/o/b7d5ab4a0a8e7cc1fad5c773eedc3552/test --cache-dir=./.zig-cache --seed=0xe052ac7b --listen=-
test
+- run test stderr
[Emulation] Command: Power On
[Emulation] Command: Shutdown
[Emulation] Command: Power On
[Emulation] Command: Reset
test
+- run test failure
[Emulation] Thread started (TID: 2521431)
[Emulation] Starting timer at 16ms per frame (60.10 Hz NTSC)
[Emulation] Shutdown signal received (frames: 2, cycles: 178683)
[Emulation] Thread stopping (total cycles: 178683)
[Render] Thread started (TID: 2521432)
[Render] Wayland window created successfully
[vulkan] (warn): Validation layers requested but not available
[Render] Vulkan renderer initialized successfully
[Render] Thread stopping (window_closed=false running=false)
[Emulation] Thread started (TID: 2521464)
[Render] Thread started (TID: 2521465)
[Emulation] Starting timer at 16ms per frame (60.10 Hz NTSC)
[Render] Wayland window created successfully
[vulkan] (warn): Validation layers requested but not available
[Render] Vulkan renderer initialized successfully
[Render] Thread stopping (window_closed=false running=false)
[Emulation] Shutdown signal received (frames: 6, cycles: 536051)
[Emulation] Thread stopping (total cycles: 536051)
[Emulation] Thread started (TID: 2521477)
[Emulation] Starting timer at 16ms per frame (60.10 Hz NTSC)
[Emulation] Command: Power On
[Emulation] Command: Reset
[Emulation] Shutdown signal received (frames: 3, cycles: 268025)
[Emulation] Thread stopping (total cycles: 268025)
[Emulation] Thread started (TID: 2521478)
[Render] Thread started (TID: 2521479)
[Emulation] Starting timer at 16ms per frame (60.10 Hz NTSC)
[Render] Wayland window created successfully
[vulkan] (warn): Validation layers requested but not available
[Render] Vulkan renderer initialized successfully
[Emu] Frame 10 diagnostics:
  Pixel[0]:     0x545454ff
  Pixel[30000]: 0x545454ff
  Pixel[61439]: 0x545454ff
  PPUMASK: 0x00 (rendering=false)
  PPUCTRL: 0x00
  Palette[0]: 0x00
  Palette[1]: 0x00

[Test] Frame mailbox: 15 frames produced
Segmentation fault at address 0x7f92da2c0000
/home/colin/Development/RAMBO/src/emulation/Ppu.zig:125:15: 0x117eb91 in tick (root.zig)
            fb[fb_index] = color;
              ^
/home/colin/Development/RAMBO/src/emulation/State.zig:1519:38: 0x115af45 in tickPpu (root.zig)
        const flags = PpuRuntime.tick(&self.ppu, scanline, dot, cart_ptr, self.framebuffer);
                                     ^
/home/colin/Development/RAMBO/src/emulation/State.zig:614:25: 0x1145f5d in tick (root.zig)
            self.tickPpu();
                        ^
/home/colin/Development/RAMBO/src/emulation/State.zig:1702:22: 0x112c828 in emulateFrame (root.zig)
            self.tick();
                     ^
/home/colin/Development/RAMBO/src/threads/EmulationThread.zig:102:42: 0x112e03c in callback (main.zig)
    const cycles = ctx.state.emulateFrame();
                                         ^
/home/colin/.cache/zig/p/libxev-0.0.0-86vtc4IcEwCqEYxEYoN_3KXmc6A9VLcm22aVImfvecYs/src/backend/io_uring.zig:804:29: 0x10f5df2 in invoke (main.zig)
        return self.callback(self.userdata, loop, self, result);
                            ^
/home/colin/.cache/zig/p/libxev-0.0.0-86vtc4IcEwCqEYxEYoN_3KXmc6A9VLcm22aVImfvecYs/src/backend/io_uring.zig:193:33: 0x10cadf6 in tick___anon_14964 (main.zig)
                switch (c.invoke(self, cqe.res)) {
                                ^
/home/colin/.cache/zig/p/libxev-0.0.0-86vtc4IcEwCqEYxEYoN_3KXmc6A9VLcm22aVImfvecYs/src/backend/io_uring.zig:84:42: 0x10cb290 in run (main.zig)
            .until_done => try self.tick_(.until_done),
                                         ^
/home/colin/Development/RAMBO/src/threads/EmulationThread.zig:258:13: 0x10cb6b7 in threadMain (root.zig)
    loop.run(.until_done) catch |err| {
            ^
/home/colin/.local/lib/zig/std/Thread.zig:510:13: 0x1098061 in callFn__anon_8010 (std.zig)
            @call(.auto, f, args);
            ^
/home/colin/.local/lib/zig/std/Thread.zig:782:30: 0x1070e0f in entryFn (std.zig)
                return callFn(f, args_ptr.*);
                             ^
???:?:?: 0x7f92da4969ca in ??? (libc.so.6)
Unwind information for `libc.so.6:0x7f92da4969ca` was not available, trace may be incomplete

???:?:?: 0x7f92da51aa0b in ??? (libc.so.6)
error: while executing test 'threading_test.test.Threading: frame mailbox communication (emulation → render, AccuracyCoin)', the following command terminated with signal 6 (expected exited with code 0):
./.zig-cache/o/ad9376a136d8fd3c77af3c46afd8b735/test --cache-dir=./.zig-cache --seed=0xe052ac7b --listen=-
test
+- run test stderr
[VBlank Wait Test] Starting emulation
  Reset vector: PC=0x8000
  Code at 0x8000: 2c 02 20 10 fb
  Expected:       2C 02 20 10 FB (BIT $2002, BPL -5)
  ✓ VBlank flag SET at scanline 241, dot 1, cycle 82182
  ✓ Success marker detected after 7900 instructions
  ✓ PPU CTRL: 0x80
  ✓ PPU MASK: 0x1e
test
+- run test stderr
Frame 60/600: 2929329.41 IPS, 32.79 FPS, 6.55x speed
Frame 120/600: 3099970.61 IPS, 34.70 FPS, 6.93x speed
Frame 180/600: 3271103.83 IPS, 36.61 FPS, 7.31x speed
Frame 240/600: 3499014.32 IPS, 39.17 FPS, 7.82x speed
Frame 300/600: 3661596.98 IPS, 40.98 FPS, 8.18x speed
Frame 360/600: 3780770.88 IPS, 42.32 FPS, 8.45x speed
Frame 420/600: 3873732.89 IPS, 43.36 FPS, 8.66x speed
Frame 480/600: 3948198.34 IPS, 44.19 FPS, 8.82x speed
Frame 540/600: 4005941.36 IPS, 44.84 FPS, 8.95x speed
Frame 600/600: 4052698.37 IPS, 45.36 FPS, 9.06x speed

=== AccuracyCoin Benchmark Results ===
Total Cycles:       214416000
Total Instructions: 53604000
Total Frames:       600
Elapsed Time:       13.227s

=== Performance ===
Instructions/sec:   4052692.80
Cycles/sec:         16210771.21
Frames/sec:         45.36
Cycles/instruction: 4.00
Instructions/frame: 89340.00

=== Accuracy ===
Speed Ratio:        9.06x real-time
Timing Accuracy:    1200.00% of ideal

Performance: 9.06x real-time (target: >10x)
WARNING: Performance below target (9.06x < 10x)
test
+- run test stderr
Frame 60/600, Instructions: 5360400
Frame 120/600, Instructions: 10720800
Frame 180/600, Instructions: 16081200
Frame 240/600, Instructions: 21441600
Frame 300/600, Instructions: 26802000
Frame 360/600, Instructions: 32162400
Frame 420/600, Instructions: 37522800
Frame 480/600, Instructions: 42883200
Frame 540/600, Instructions: 48243600
Frame 600/600, Instructions: 53604000

=== AccuracyCoin Test Results ===
Frames executed: 600
Instructions executed: 53604000
Timed out: false

Test Status Bytes: $00 $00 $00 $00 

✅ All tests PASSED

=== Known Gaps from Gap Analysis ===
Missing APU features (expected failures):
  ❌ Length counters (32-value table, half-frame decrement)
  ❌ Envelopes (quarter-frame clocking)
  ❌ Linear counter (triangle channel)
  ❌ Sweep units (half-frame clocking)
  ❌ DMC timer (sample playback)


=== Sampling AccuracyCoin Test Status ===
Frame  60: Status = [00, 00, 00, 00] (all passed)
Frame 120: Status = [00, 00, 00, 00] (all passed)
Frame 180: Status = [00, 00, 00, 00] (all passed)
Frame 240: Status = [00, 00, 00, 00] (all passed)
Frame 300: Status = [00, 00, 00, 00] (all passed)

Note: This is an informational test - failures expected during Phase 1

Build Summary: 95/98 steps succeeded; 2 failed; 899/902 tests passed; 1 skipped; 2 failed
test transitive failure
+- run test 13/15 passed, 2 failed
+- run test failure

error: the following build command failed with exit code 1:
.zig-cache/o/2e4e056eb696955daeb265ff6a85b9d9/build /home/colin/.local/bin/zig /home/colin/.local/lib/zig /home/colin/Development/RAMBO .zig-cache /home/colin/.cache/zig --seed 0xe052ac7b -Z43b20a85a359bc82 test
